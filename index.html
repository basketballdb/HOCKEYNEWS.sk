<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Private Photo Feed</title>

<style>
body{
    font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto;
    margin:0;
    background:#f5f5f7;
}

/* HEADER */
header{
    background:white;
    padding:20px;
    position:sticky;
    top:0;
    z-index:10;
    box-shadow:0 2px 8px rgba(0,0,0,0.05);
}
header h1{
    margin:0 0 10px 0;
}

/* SEARCH */
.searchbar{
    display:flex;
    gap:10px;
    flex-wrap:wrap;
}
input,textarea{
    padding:10px;
    border-radius:8px;
    border:1px solid #ddd;
    font-size:14px;
}
button{
    padding:10px 15px;
    border:none;
    border-radius:8px;
    background:black;
    color:white;
    cursor:pointer;
}
button:hover{
    opacity:0.8;
}

.container{
    max-width:900px;
    margin:auto;
    padding:20px;
}

/* CREATE POST */
.create-post{
    background:white;
    padding:20px;
    border-radius:15px;
    box-shadow:0 5px 15px rgba(0,0,0,0.05);
    margin-bottom:30px;
}

/* FEED */
#feed{
    display:grid;
    grid-template-columns:repeat(auto-fill,minmax(280px,1fr));
    gap:20px;
}

.post{
    background:white;
    border-radius:15px;
    overflow:hidden;
    box-shadow:0 5px 15px rgba(0,0,0,0.05);
    cursor:pointer;
    transition:transform 0.2s ease;
}
.post:hover{
    transform:scale(1.03);
}
.post img{
    width:100%;
    height:220px;
    object-fit:cover;
}
.post-content{
    padding:15px;
}
.description{
    font-size:14px;
    margin-bottom:5px;
}
.date{
    font-size:12px;
    color:gray;
}

/* POST MODAL */
#postModal{
    display:none;
    position:fixed;
    inset:0;
    background:rgba(0,0,0,0.85);
    justify-content:center;
    align-items:center;
    z-index:200;
}
.post-modal-content{
    background:white;
    width:95%;
    max-width:1000px;
    max-height:90%;
    overflow:auto;
    border-radius:20px;
    padding:25px;
}
.post-modal-content img{
    width:100%;
    margin-bottom:15px;
    cursor:pointer;
}
.close-btn{
    float:right;
    font-size:22px;
    cursor:pointer;
    color:#999;
}
.close-btn:hover{
    color:black;
}

/* FULLSCREEN */
#fullscreen{
    display:none;
    position:fixed;
    inset:0;
    background:black;
    justify-content:center;
    align-items:center;
    z-index:300;
}
#fullscreen img{
    max-width:90%;
    max-height:90%;
    cursor:grab;
    transition:transform 0.15s ease;
}
</style>
</head>
<body>

<header>
<h1>My Private Feed</h1>
<div class="searchbar">
<input type="text" id="searchText" placeholder="Search description...">
<input type="date" id="searchDate">
<button onclick="searchPosts()">Search</button>
<button onclick="clearSearch()">Clear</button>
</div>
</header>

<div class="container">

<div class="create-post">
<h3>Create Post</h3>
<textarea id="descriptionInput" placeholder="Write description..."></textarea><br><br>
<input type="file" id="imageInput" multiple accept="image/*"><br><br>
<button onclick="createPost()">Create Post</button>
</div>

<div id="feed"></div>

</div>

<!-- POST DETAIL MODAL -->
<div id="postModal">
<div class="post-modal-content">
<span class="close-btn" onclick="closePostModal()">âœ•</span>
<div id="modalImages"></div>
<div id="modalDescription"></div>
<div id="modalDate" style="color:gray;font-size:13px;"></div>
</div>
</div>

<!-- FULLSCREEN -->
<div id="fullscreen" onclick="closeFullscreen()">
<img id="fsImage">
</div>

<script>

/* =====================
   INDEXED DB
===================== */

let db;
const request = indexedDB.open("PhotoFeedDB",1);

request.onupgradeneeded = function(e){
    db = e.target.result;
    db.createObjectStore("posts",{keyPath:"id",autoIncrement:true});
};

request.onsuccess = function(e){
    db = e.target.result;
    loadPosts();
};

function addPostToDB(post){
    const tx = db.transaction("posts","readwrite");
    const store = tx.objectStore("posts");
    store.add(post);
    tx.oncomplete = loadPosts;
}

/* =====================
   CREATE POST
===================== */

function createPost(){
    const desc = document.getElementById("descriptionInput").value;
    const files = document.getElementById("imageInput").files;

    if(files.length===0){
        alert("Select at least one image");
        return;
    }

    let images=[];
    let loaded=0;

    for(let i=0;i<files.length;i++){
        const reader = new FileReader();
        reader.onload=function(e){
            images.push(e.target.result);
            loaded++;
            if(loaded===files.length){
                addPostToDB({
                    description:desc,
                    images:images,
                    date:new Date().toISOString().split("T")[0]
                });
                document.getElementById("descriptionInput").value="";
                document.getElementById("imageInput").value="";
            }
        };
        reader.readAsDataURL(files[i]);
    }
}

/* =====================
   LOAD & RENDER
===================== */

function loadPosts(){
    const feed=document.getElementById("feed");
    feed.innerHTML="";
    const tx=db.transaction("posts","readonly");
    const store=tx.objectStore("posts");

    store.openCursor(null,"prev").onsuccess=function(e){
        const cursor=e.target.result;
        if(cursor){
            renderPost(cursor.value);
            cursor.continue();
        }
    };
}

function renderPost(post){
    const feed=document.getElementById("feed");

    const postDiv=document.createElement("div");
    postDiv.className="post";

    const img=document.createElement("img");
    img.src=post.images[0];
    postDiv.appendChild(img);

    const content=document.createElement("div");
    content.className="post-content";

    const desc=document.createElement("div");
    desc.className="description";
    desc.innerText=post.description.length>100 
        ? post.description.substring(0,100)+"..."
        : post.description;

    const date=document.createElement("div");
    date.className="date";
    date.innerText=post.date;

    content.appendChild(desc);
    content.appendChild(date);
    postDiv.appendChild(content);

    postDiv.onclick=()=>openPostModal(post);

    feed.appendChild(postDiv);
}

/* =====================
   SEARCH
===================== */

function searchPosts(){
    const text=document.getElementById("searchText").value.toLowerCase();
    const date=document.getElementById("searchDate").value;

    const feed=document.getElementById("feed");
    feed.innerHTML="";

    const tx=db.transaction("posts","readonly");
    const store=tx.objectStore("posts");

    store.openCursor(null,"prev").onsuccess=function(e){
        const cursor=e.target.result;
        if(cursor){
            const post=cursor.value;
            if(
                (text==="" || post.description.toLowerCase().includes(text)) &&
                (date==="" || post.date===date)
            ){
                renderPost(post);
            }
            cursor.continue();
        }
    };
}

function clearSearch(){
    document.getElementById("searchText").value="";
    document.getElementById("searchDate").value="";
    loadPosts();
}

/* =====================
   POST MODAL
===================== */

function openPostModal(post){
    const modal=document.getElementById("postModal");
    const imagesContainer=document.getElementById("modalImages");
    const desc=document.getElementById("modalDescription");
    const date=document.getElementById("modalDate");

    imagesContainer.innerHTML="";

    post.images.forEach(img=>{
        const image=document.createElement("img");
        image.src=img;
        image.onclick=()=>openFullscreen(img);
        imagesContainer.appendChild(image);
    });

    desc.innerText=post.description;
    date.innerText=post.date;

    modal.style.display="flex";
}

function closePostModal(){
    document.getElementById("postModal").style.display="none";
}

/* =====================
   FULLSCREEN + ZOOM
===================== */

let scale=1,translateX=0,translateY=0,isDragging=false,startX,startY;

function openFullscreen(src){
    const fs=document.getElementById("fullscreen");
    const img=document.getElementById("fsImage");
    img.src=src;
    fs.style.display="flex";
    resetZoom();
}

function closeFullscreen(){
    document.getElementById("fullscreen").style.display="none";
}

function resetZoom(){
    scale=1;translateX=0;translateY=0;
    updateTransform();
}

function updateTransform(){
    document.getElementById("fsImage").style.transform=
        `translate(${translateX}px,${translateY}px) scale(${scale})`;
}

const fsImage=document.getElementById("fsImage");

fsImage.addEventListener("wheel",e=>{
    e.preventDefault();
    scale+=e.deltaY<0?0.1:-0.1;
    if(scale<1)scale=1;
    updateTransform();
});

fsImage.addEventListener("mousedown",e=>{
    if(scale<=1)return;
    isDragging=true;
    startX=e.clientX-translateX;
    startY=e.clientY-translateY;
});

document.addEventListener("mousemove",e=>{
    if(!isDragging)return;
    translateX=e.clientX-startX;
    translateY=e.clientY-startY;
    updateTransform();
});

document.addEventListener("mouseup",()=>isDragging=false);

fsImage.addEventListener("dblclick",()=>{
    scale=scale===1?2:1;
    updateTransform();
});

</script>
</body>
</html>
