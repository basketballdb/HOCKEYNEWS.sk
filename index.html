<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Private Photo Feed</title>
<style>
body{
    font-family: Arial, sans-serif;
    margin:0;
    background:#fafafa;
}
header{
    background:white;
    padding:15px;
    position:sticky;
    top:0;
    box-shadow:0 2px 6px rgba(0,0,0,0.05);
    z-index:10;
}
h1{
    margin:0;
}
.container{
    max-width:700px;
    margin:auto;
    padding:20px;
}
.post{
    background:white;
    border-radius:12px;
    margin-bottom:25px;
    box-shadow:0 4px 10px rgba(0,0,0,0.05);
    overflow:hidden;
}
.post img{
    width:100%;
    cursor:pointer;
}
.post-content{
    padding:15px;
}
.description{
    margin-bottom:10px;
}
.date{
    font-size:12px;
    color:gray;
}
button{
    padding:10px 15px;
    border:none;
    border-radius:8px;
    background:#007bff;
    color:white;
    cursor:pointer;
}
button:hover{
    background:#0056b3;
}
input, textarea{
    width:100%;
    margin-bottom:10px;
    padding:8px;
}
#fullscreen{
    display:none;
    position:fixed;
    top:0;
    left:0;
    width:100%;
    height:100%;
    background:rgba(0,0,0,0.9);
    justify-content:center;
    align-items:center;
    z-index:100;
}
#fullscreen img{
    max-width:90%;
    max-height:90%;
    cursor:grab;
    transition:transform 0.2s;
}
.searchbar{
    margin-top:10px;
}
</style>
</head>
<body>

<header>
<h1>My Private Feed</h1>
<div class="searchbar">
<input type="text" id="searchText" placeholder="Search by description...">
<input type="date" id="searchDate">
<button onclick="searchPosts()">Search</button>
<button onclick="clearSearch()">Clear</button>
</div>
</header>

<div class="container">

<h3>Create Post</h3>
<textarea id="descriptionInput" placeholder="Write description..."></textarea>
<input type="file" id="imageInput" multiple accept="image/*">
<button onclick="createPost()">Create Post</button>

<hr>

<div id="feed"></div>

</div>

<div id="fullscreen" onclick="closeFullscreen()">
<img id="fsImage">
</div>

<script>

/* =========================
   INDEXED DB SETUP
========================= */

let db;
const request = indexedDB.open("PhotoFeedDB",1);

request.onupgradeneeded = function(e){
    db = e.target.result;
    db.createObjectStore("posts",{keyPath:"id",autoIncrement:true});
};

request.onsuccess = function(e){
    db = e.target.result;
    loadPosts();
};

function addPostToDB(post){
    const tx = db.transaction("posts","readwrite");
    const store = tx.objectStore("posts");
    store.add(post);
    tx.oncomplete = loadPosts;
}

/* =========================
   CREATE POST
========================= */

function createPost(){
    const desc = document.getElementById("descriptionInput").value;
    const files = document.getElementById("imageInput").files;

    if(files.length===0){
        alert("Select at least one image");
        return;
    }

    let images = [];
    let loaded = 0;

    for(let i=0;i<files.length;i++){
        const reader = new FileReader();
        reader.onload = function(e){
            images.push(e.target.result);
            loaded++;
            if(loaded===files.length){
                const post={
                    description:desc,
                    images:images,
                    date:new Date().toISOString().split("T")[0]
                };
                addPostToDB(post);
                document.getElementById("descriptionInput").value="";
                document.getElementById("imageInput").value="";
            }
        };
        reader.readAsDataURL(files[i]);
    }
}

/* =========================
   LOAD POSTS
========================= */

function loadPosts(){
    const feed = document.getElementById("feed");
    feed.innerHTML="";

    const tx = db.transaction("posts","readonly");
    const store = tx.objectStore("posts");

    store.openCursor(null,"prev").onsuccess = function(e){
        const cursor = e.target.result;
        if(cursor){
            renderPost(cursor.value);
            cursor.continue();
        }
    };
}

function renderPost(post){
    const feed = document.getElementById("feed");

    const postDiv = document.createElement("div");
    postDiv.className="post";

    post.images.forEach(img=>{
        const image = document.createElement("img");
        image.src = img;
        image.onclick = ()=>openFullscreen(img);
        postDiv.appendChild(image);
    });

    const content = document.createElement("div");
    content.className="post-content";

    const desc = document.createElement("div");
    desc.className="description";
    desc.innerText=post.description;

    const date = document.createElement("div");
    date.className="date";
    date.innerText=post.date;

    content.appendChild(desc);
    content.appendChild(date);
    postDiv.appendChild(content);

    feed.appendChild(postDiv);
}

/* =========================
   SEARCH
========================= */

function searchPosts(){
    const text = document.getElementById("searchText").value.toLowerCase();
    const date = document.getElementById("searchDate").value;

    const feed = document.getElementById("feed");
    feed.innerHTML="";

    const tx = db.transaction("posts","readonly");
    const store = tx.objectStore("posts");

    store.openCursor(null,"prev").onsuccess = function(e){
        const cursor = e.target.result;
        if(cursor){
            const post = cursor.value;
            if(
                (text==="" || post.description.toLowerCase().includes(text)) &&
                (date==="" || post.date===date)
            ){
                renderPost(post);
            }
            cursor.continue();
        }
    };
}

function clearSearch(){
    document.getElementById("searchText").value="";
    document.getElementById("searchDate").value="";
    loadPosts();
}

/* =========================
   FULLSCREEN + ZOOM
========================= */

let scale=1;
let translateX=0;
let translateY=0;
let isDragging=false;
let startX,startY;

function openFullscreen(src){
    const fs=document.getElementById("fullscreen");
    const img=document.getElementById("fsImage");
    img.src=src;
    fs.style.display="flex";
    resetZoom();
}

function closeFullscreen(){
    document.getElementById("fullscreen").style.display="none";
}

function resetZoom(){
    scale=1;
    translateX=0;
    translateY=0;
    updateTransform();
}

function updateTransform(){
    const img=document.getElementById("fsImage");
    img.style.transform=`translate(${translateX}px,${translateY}px) scale(${scale})`;
}

const img=document.getElementById("fsImage");

img.addEventListener("wheel",e=>{
    e.preventDefault();
    if(e.deltaY<0) scale+=0.1;
    else scale-=0.1;
    if(scale<1) scale=1;
    updateTransform();
});

img.addEventListener("mousedown",e=>{
    if(scale<=1) return;
    isDragging=true;
    startX=e.clientX-translateX;
    startY=e.clientY-translateY;
});

document.addEventListener("mousemove",e=>{
    if(!isDragging) return;
    translateX=e.clientX-startX;
    translateY=e.clientY-startY;
    updateTransform();
});

document.addEventListener("mouseup",()=>isDragging=false);

img.addEventListener("dblclick",()=>{
    if(scale===1) scale=2;
    else resetZoom();
    updateTransform();
});

</script>

</body>
</html>
